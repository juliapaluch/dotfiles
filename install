#!/usr/bin/env bash
set -e

check_install () {
	echo -n "checking if $1 is installed... "
	if command -v $1 &> /dev/null ; then
		echo "✓"
	else
		echo "✗"
		return 1
	fi
}

check_install git
check_install nvim
check_install tmux
check_install atuin
check_install ghostty

# oh-my-zsh
if [ ! -d ~/.oh-my-zsh ]; then
	echo "oh-my-zsh not found. installing..."
	sh -c "$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)"
else
	echo "oh-my-zsh already installed. skipping..."
fi

# zsh
if [ ! -f ~/.zshrc ]; then
	ln -s ${PWD}/zsh/zshrc ~/.zshrc
else
	echo "zshrc already exists. skipping..."
fi

# neovim
if [ ! -d ~/.config/nvim ]; then
	ln -s ${PWD}/nvim ~/.config/nvim
else
	echo "neovim config already exists. skipping..."
fi

# tmux
if [ ! -d ~/.tmux/plugins/tpm ]; then
	git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm
fi
if [ ! -d ~/.config/tmux ]; then
	ln -s ${PWD}/tmux ~/.config/tmux
	echo "don't forget to disable the default ctrl-space binding in MacOS so you can use it as the tmux prefix"
	echo "System Settings > Keyboard shortcuts > Input Sources - uncheck all"
else
	echo "tmux config already exists. skipping..."
fi

# ghostty
if [ ! -d ~/.config/ghostty ]; then
	ln -s ${PWD}/ghostty ~/.config/ghostty
else
	echo "ghostty config already exists. skipping..."
fi

# add git aliases if none already defined
if ! grep -q "[alias]" ~/.gitconfig; then
	cat ${PWD}/git/.gitconfig >> ~/.gitconfig
else
	echo "git aliases already defined. skipping..."
fi
